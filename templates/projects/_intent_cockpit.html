{% load rw_extras %}
<form method="post" action="{% url 'projects:project_review_anchor_update' project.id %}" class="mt-3" data-ajax-save-form="1">
  {% csrf_token %}
  <input type="hidden" name="marker" value="{{ s.marker }}" />
  <div class="border rounded bg-white p-2">
    <div class="d-flex flex-wrap gap-2 align-items-center justify-content-between">
      <div class="fw-semibold">Intent cockpit</div>
      <div class="d-flex flex-wrap gap-2">
        <span class="badge text-bg-secondary">Scope {{ s.intent_fields.scope|count_items }}</span>
        <span class="badge text-bg-secondary">Assumptions {{ s.intent_fields.assumptions|count_items }}</span>
        <span class="badge text-bg-secondary">Alternatives {{ s.intent_fields.alternatives_considered|count_items }}</span>
        <span class="badge text-bg-secondary">Limits {{ s.intent_fields.uncertainties_limits|count_items }}</span>
      </div>
    </div>
    <label class="form-label small text-muted mt-2 mb-1">Canonical summary</label>
    <input class="form-control form-control-sm" name="cko_canonical_summary" value="{{ s.intent_fields.canonical_summary }}">
  </div>

  <details class="mt-3 border rounded bg-white p-2" open>
    <summary class="fw-semibold">Core</summary>
    <div class="mt-2">
      <label class="form-label small text-muted mb-1">Statement</label>
      <textarea class="form-control mb-3" rows="3" name="cko_statement">{{ s.intent_fields.statement }}</textarea>
      <label class="form-label small text-muted mb-1">Supporting basis</label>
      <textarea class="form-control" rows="4" name="cko_supporting_basis">{{ s.intent_fields.supporting_basis }}</textarea>
    </div>
  </details>

  <details class="mt-2 border rounded bg-white p-2">
    <summary class="fw-semibold">Assumptions and limits</summary>
    <div class="mt-2">
      <label class="form-label small text-muted mb-1">Assumptions</label>
      <textarea class="form-control mb-3" rows="3" name="cko_assumptions">{{ s.intent_fields.assumptions }}</textarea>
      <label class="form-label small text-muted mb-1">Uncertainties / limits</label>
      <textarea class="form-control" rows="3" name="cko_uncertainties_limits">{{ s.intent_fields.uncertainties_limits }}</textarea>
    </div>
  </details>

  <details class="mt-2 border rounded bg-white p-2">
    <summary class="fw-semibold">Alternatives and provenance</summary>
    <div class="mt-2">
      <label class="form-label small text-muted mb-1">Alternatives considered</label>
      <textarea class="form-control mb-3" rows="3" name="cko_alternatives_considered">{{ s.intent_fields.alternatives_considered }}</textarea>
      <label class="form-label small text-muted mb-1">Provenance</label>
      <textarea class="form-control" rows="3" name="cko_provenance">{{ s.intent_fields.provenance }}</textarea>
    </div>
  </details>

  <details class="mt-2 border rounded bg-white p-2">
    <summary class="fw-semibold">Scope</summary>
    <div class="mt-2">
      <textarea class="form-control" rows="3" name="cko_scope">{{ s.intent_fields.scope }}</textarea>
    </div>
  </details>
</form>
