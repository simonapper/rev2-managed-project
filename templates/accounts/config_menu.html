{# -*- coding: utf-8 -*- #}
{# templates/accounts/config_menu.html #}
{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid px-4 py-4">

  <div class="d-flex align-items-start justify-content-between mb-3">
    <div>
      <h3 class="mb-1">Settings</h3>
    </div>

    <a class="btn btn-sm btn-outline-secondary" href="{% url 'accounts:dashboard' %}">Back</a>
  </div>
    <!--<div class="text-secondary small mb-2">
      debug: active_chat_id={{ active_chat_id|default:"(none)" }},
      can_override_chat={{ can_override_chat|default:"(missing)" }}
    </div>-->

  <div class="card mb-3" style="max-width: 50rem;">
    <div class="card-body">
      <h5 class="card-title mb-2">LLM Settings</h5>
      <form method="post" class="row g-2 align-items-start">
        {% csrf_token %}
        <div class="col-12 col-md-6">
          <label class="form-label small mb-1">Provider</label>
          <select id="llm-provider" name="llm_provider" class="form-select form-select-sm">
            <option value="openai"{% if llm_provider == "openai" %} selected="selected"{% endif %}>OpenAI</option>
            <option value="anthropic"{% if llm_provider == "anthropic" %} selected="selected"{% endif %}>Anthropic</option>
          </select>
        </div>

        <div id="openai-model-wrap" class="col-12 col-md-6">
          <label class="form-label small mb-1">OpenAI model</label>
          <select name="openai_model_default" class="form-select form-select-sm">
            {% for val, label in openai_model_choices %}
            <option value="{{ val }}"{% if openai_model_default == val %} selected="selected"{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>

        <div id="anthropic-model-wrap" class="col-12 col-md-6">
          <label class="form-label small mb-1">Anthropic model</label>
          <select name="anthropic_model_default" class="form-select form-select-sm">
            {% for val, label in anthropic_model_choices %}
            <option value="{{ val }}"{% if anthropic_model_default == val %} selected="selected"{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>

        <div id="provider-hint" class="col-12 col-md-6 small text-muted mt-1">
          Pick the provider first. The model list follows that choice.
        </div>

        <div id="anthropic-model-hint" class="col-12 col-md-6 small text-muted mt-1">
          Sonnet is the best default for most work.
          Opus is strongest but costs more.
          Haiku is fastest and cheapest.
        </div>

        <div class="col-12 mt-2">
          <button type="submit" class="btn btn-sm btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>


  <div class="rw-config-buttons">
    <a href="{% url 'accounts:user_config_user' %}"
       class="btn btn-outline-primary btn-sm rw-config-btn">
      User
    </a>

    <a href="{% url 'accounts:project_config_list' %}"
       class="btn btn-outline-primary btn-sm rw-config-btn">
      Project
    </a>

    {% if can_override_chat %}
    <a href="{% url 'accounts:chat_config_overrides' %}"
       class="btn btn-outline-primary btn-sm rw-config-btn">
      This Chat
    </a>
    {% endif %}

    <a href="{% url 'imports:preview_import' %}"
       class="btn btn-outline-primary btn-sm rw-config-btn">
      Import ChatGPT
    </a>
  </div>

</div>

<script>
  (function () {
    var provider = document.getElementById("llm-provider");
    var openaiWrap = document.getElementById("openai-model-wrap");
    var anthropicWrap = document.getElementById("anthropic-model-wrap");
    var anthropicHint = document.getElementById("anthropic-model-hint");

    function syncModelVisibility() {
      var p = (provider && provider.value) || "openai";
      var useOpenAI = p === "openai";
      if (openaiWrap) {
        openaiWrap.style.display = useOpenAI ? "" : "none";
      }
      if (anthropicWrap) {
        anthropicWrap.style.display = useOpenAI ? "none" : "";
      }
      if (anthropicHint) {
        anthropicHint.style.display = useOpenAI ? "none" : "";
      }
    }

    if (provider) {
      provider.addEventListener("change", syncModelVisibility);
      syncModelVisibility();
    }
  })();
</script>
{% endblock %}
